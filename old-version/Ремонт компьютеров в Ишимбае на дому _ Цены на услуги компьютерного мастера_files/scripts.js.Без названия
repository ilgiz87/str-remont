AOS.init();
// ============= PRELOADER SCRIPT ===================
window.onload = function() {
    $('#preloader').addClass('hid');
};
// ============= END PRELOADER SCRIPT ===================


/*closestchild*/
;
(function($) {
    $.fn.closestChild = function(selector) {
        var $children, $results;

        $children = this.children();

        if ($children.length === 0)
            return $();

        $results = $children.filter(selector);

        if ($results.length > 0)
            return $results;
        else
            return $children.closestChild(selector);
    };
})(window.jQuery);

/* /. closestchild*/



$(function() {
    
    if (window.devicePixelRatio > 1) {
        var lowresImages = $('img[data-retinasrc]'), thiswidth, thisheight;
        
        
        lowresImages.each(function(i) {
            thiswidth = $(this).width();
            thisheight = $(this).height();
            
            $(this).attr( 'width', thiswidth );
            $(this).attr( 'height', thisheight );
            
            var lowres = $(this).attr('src');
            var highres = $(this).data('retinasrc');
            $(this).attr('src', highres);
        });
        
    }
    
    var top_show = 280; // В каком положении полосы прокрутки начинать показ кнопки "Наверх"
    var speed = 500; // Скорость прокрутки
    var $backButton = $('#up');
    $(window).scroll(function() { // При прокрутке попадаем в эту функцию
        /* В зависимости от положения полосы прокрукти и значения top_show, скрываем или открываем кнопку "Наверх" */
        if ($(this).scrollTop() > top_show) {
            $backButton.fadeIn();
        } else {
            $backButton.fadeOut();
        }
    });
    $backButton.click(function() { // При клике по кнопке "Наверх" попадаем в эту функцию
        /* Плавная прокрутка наверх */
        scrollto(0, speed);
    });

    // scrollto
    window.scrollto = function(destination, speed) {
        if (typeof speed == 'undefined') {
            speed = 800;
        }
        jQuery("html:not(:animated),body:not(:animated)").animate({
            scrollTop: destination - 60
        }, speed);
    };
    $("a.scrollto").click(function() {
        var elementClick = $(this).attr("href")
        var destination = $(elementClick).offset().top;
        scrollto(destination);
        return false;
    });
    // end scrollto 

    // fancybox
    $('.fancybox').fancybox({
        padding: 0,
        openEffect: 'none',
        closeEffect: 'none',
        nextEffect: 'none',
        prevEffect: 'none',
        helpers: {
            overlay: {
                locked: false
            }
        }
    });

    $('.fancyboxModal').fancybox({
        padding: 0,
        openEffect: 'none',
        closeEffect: 'none',
        nextEffect: 'none',
        prevEffect: 'none',
        fitToView: false,
        maxWidth: '100%',
        scrolling: "no",
        wrapCSS : 'fancybox-modal-wrap',
        helpers: {
            overlay: {
                locked: false
            }
        }
    });
    // end fancybox


    $('.fancyboxVideo').fancybox({
        autoResize: true,
        padding: 0,
        openEffect: 'fade',
        closeEffect: 'fade',
        nextEffect: 'none',
        prevEffect: 'none',
        fitToView: false,
        maxWidth: '100%',
        maxHeight: '100%',
        scrolling: "no",
        width: 1200,
        height: 700,
        helpers: {
            overlay: {
                locked: false
            }
        }
    });

    $('.fancyboxVideo-xs').fancybox({
        autoResize: true,
        padding: 0,
        openEffect: 'fade',
        closeEffect: 'fade',
        nextEffect: 'none',
        prevEffect: 'none',
        fitToView: false,
        maxWidth: '100%',
        maxHeight: '50%',
        scrolling: "no",
        helpers: {
            overlay: {
                locked: false
            }
        }
    });


    // slick-carousel
    $('.top-slider').slick({
        infinite: true,
        slidesToShow: 1,
        slidesToScroll: 1,
        autoplay: true,
        autoplaySpeed: 4000,
        speed: 500,
        arrows: true,
        prevArrow: '<a href="#" class="slick-prev"></a>',
        nextArrow: '<a href="#" class="slick-next"></a>',
        dots: false,
        responsive: [{
            breakpoint: 1330,
            settings: {
                arrows: false,
            }
        }]
    });



    $('.reviews-carousel').slick({
        infinite: true,
        slidesToShow: 3,
        slidesToScroll: 1,
        autoplay: true,
        autoplaySpeed: 5000,
        speed: 500,
        arrows: false,
        dots: false,
        responsive: [{
            breakpoint: 1230,
            settings: {
                slidesToShow: 2
            }
        }, {
            breakpoint: 992,
            settings: {
                slidesToShow: 1
            }
        }]
    });


    $('.products-carousel.products-carousel-1').slick({
        infinite: true,
        slidesToShow: 4,
        slidesToScroll: 1,
        autoplay: true,
        autoplaySpeed: 5000,
        speed: 500,
        arrows: false,
        dots: false,
        swipeToSlide: true,
        responsive: [{
            breakpoint: 1230,
            settings: {
                slidesToShow: 3
            }
        }, {
            breakpoint: 992,
            settings: {
                slidesToShow: 2
            }
        }, {
            breakpoint: 768,
            settings: {
                slidesToShow: 1
            }
        }]
    });

    $('.products-carousel.products-carousel-2').slick({
        infinite: true,
        slidesToShow: 3,
        slidesToScroll: 1,
        autoplay: true,
        autoplaySpeed: 5000,
        speed: 500,
        arrows: false,
        dots: false,
        swipeToSlide: true,
        responsive: [{
            breakpoint: 1230,
            settings: {
                slidesToShow: 2
            }
        }, {
            breakpoint: 768,
            settings: {
                slidesToShow: 1
            }
        }]
    });




    //slick-carousels end


    // checking for placeholder
    if (Modernizr.input.placeholder) {
        $('.label').hide();
    }
    // end


    // validation

    $('.rf').each(function() {
        var item = $(this),
            btn = item.find('.btn');

        function checkInput() {
            item.find('select.required').each(function() {
                if ($(this).val() == '0') {
                    $(this).parents('.form-group').addClass('error');
                    $(this).parents('.form-group').find('.error-message').show();
                } else {
                    $(this).parents('.form-group').removeClass('error');
                }
            });

            item.find('input[type=text].required').each(function() {
                if ($(this).val() != '') {
                    $(this).removeClass('error');
                } else {
                    $(this).addClass('error');
                    $(this).parent('.form-group').find('.error-message').show();
                }
            });
            
            item.find('input[type=tel].required').each(function() {
                if ($(this).val() != '') {
                    $(this).removeClass('error');
                } else {
                    $(this).addClass('error');
                    $(this).parent('.form-group').find('.error-message').show();
                }
            });

            item.find('textarea.required').each(function() {
                if ($(this).val() != '') {
                    $(this).removeClass('error');
                } else {
                    $(this).addClass('error');
                    $(this).parent('.form-group').find('.error-message').show();
                }
            });

            item.find('input[type=email]').each(function() {
                var regexp = /^([a-z0-9_-]+\.)*[a-z0-9_-]+@[a-z0-9_-]+(\.[a-z0-9_-]+)*\.[a-z]{2,6}$/i;
                var $this = $(this);
                if ($this.hasClass('required')) {
                    if (regexp.test($this.val())) {
                        $this.removeClass('error');
                    } else {
                        $this.addClass('error');
                        $(this).parent('.form-group').find('.error-message').show();
                    }
                } else {
                    if ($this.val() != '') {
                        if (regexp.test($this.val())) {
                            $this.removeClass('error');
                        } else {

                            $this.addClass('error');
                            $(this).parent('.form-group').find('.error-message').show();
                        }
                    } else {
                        $this.removeClass('error');
                    }
                }
            });


            item.find('input[type=checkbox].required').each(function() {
                if ($(this).is(':checked')) {
                    $(this).removeClass('error');
                } else {
                    $(this).addClass('error');
                    $(this).parent('.form-group').find('.error-message').show();
                }
            });
        }

        btn.click(function() {
            checkInput();
            var sizeEmpty = item.find('.error:visible').length;
            if (sizeEmpty > 0) {
                return false;
            } else {
                item.submit();
                $.fancybox.close();
            }
        });
    });


    $('select').change(function() {
        if ($(this).val() == '') {
            $(this).parents('.form-group').removeClass('selected');
        } else {
            $(this).parents('.form-group').addClass('selected');
            $(this).parents('.form-group').removeClass('error');
        }
    });

    // end validation



    // проверка на Internet Explorer 6-11
    var isIE = /*@cc_on!@*/ false || !!document.documentMode;


    if (isIE) {
        $('body').addClass('ie');
    }
    // end



    $('.mob-menu-btn').click(function() {
        if ($(this).hasClass('active')) {
            $('.mobile-menu').slideUp(200);
            $(this).removeClass('active')
        } else {
            $('.mobile-menu').slideDown(200);
            $(this).addClass('active')
        }
    });

    $('.mobile-menu ul > li').has('ul').addClass('down');


    $('.mobile-menu .down .dropdown-button').click(function() {
        $(this).toggleClass('active');
        $(this).siblings('ul:visible').slideUp(200);
        $(this).siblings('ul:hidden').slideDown(200);
    });



    $('.top-menu ul > li').has('ul').addClass('down');




    // mobMenuHeight begin

    var windHeight, panel = $('.top-bar'),
        pos = $('.header').height();

    function mobMenuHeight() {
        windHeight = $(window).height();
        $('.mobile-menu > ul').height(windHeight - $('.top-bar').height());
    }
    mobMenuHeight();


    window.addEventListener("resize", function() {
        mobMenuHeight();
    }, false);


    window.addEventListener("orientationchange", function() {
        mobMenuHeight();
    }, false);


    // mobMenuHeight end



    $(window).scroll(function() {
        if ($(this).scrollTop() > pos && !panel.hasClass('fixed')) {
            panel.addClass('fixed');
        } else if ($(this).scrollTop() < pos && panel.hasClass('fixed')) {
            panel.removeClass('fixed');
        }
    });




    // accordeon
    var $thisElement,
        $thisElementContent,
        $elements,
        $elementsContent;

    $('.accordeon .title').click(function() {
        $thisElement = $(this).parent();
        $thisElementContent = $thisElement.find('.element-content');
        $elements = $thisElement.siblings();
        $elementsContent = $elements.find('.element-content');

        $elements.removeClass('active');
        $elementsContent.slideUp();
        if (!$thisElement.hasClass('active')) {
            $thisElement.addClass('active');
            $thisElementContent.slideDown();
        } else {
            $thisElement.removeClass('active');
            $thisElementContent.slideUp();
        }

    });

    // lightgallery begin

    $(".lightgallery").lightGallery({
        selector: 'a',
        thumbnail: false
    });

    // light gallery end 




    // map height begin

    var contactswrapperHeight;

    function mapHeight() {
        contactswrapperHeight = $('.contacts-wrapper').height();
        $('.map-wrapper').css({
            'height': contactswrapperHeight
        });
    }
    mapHeight();

    window.addEventListener("resize", function() {
        mapHeight();
    }, false);


    window.addEventListener("orientationchange", function() {
        mapHeight();
    }, false);

    // map height end




    // ASIDE MENU


    $('.aside-menu li').has('ul').addClass('down');

    $('.aside-menu > ul li.down > ul').before('<span class="dropdown-button"></span>');


    $('.aside-menu .down .dropdown-button').each(function() {
        if ($(this).siblings('ul').is(':visible')) {
            $(this).addClass('active');
        }
    });



    $('.aside-menu .down .dropdown-button').click(function() {



        $(this).parent().toggleClass('open');
        if ($(this).siblings('ul').is(':visible')) {
            $(this).siblings('ul').slideUp();
            $(this).removeClass('active');
        } else {
            $(this).siblings('ul').slideDown();
            $(this).addClass('active');
        }

    });


    $('.aside-menu-title').click(function() {
        $('.aside-menu').toggleClass('active');
    });


    // ASIDE MENU END




    // tabs

    $('ul.tabs').on('click', 'li:not(.current)', function() {


        $(this)
            .addClass('current').siblings().removeClass('current')
            .closest('div.section').closestChild('div.box').removeClass('visible').eq($(this).index()).addClass('visible');
    });



    $('ul.tabs.mobile li').click(function() {
        $(this).parent().hide().siblings('.mobile-tab-header').html($(this).html());
        $('.mobile-tab-header').removeClass('active');
    });

    $('.mobile-tab-header').click(function(e) {
        if ($(this).hasClass('active')) {
            $(this).removeClass('active');
            $(this).siblings('.tabs.mobile').stop().slideUp(0);
        } else {
            $(this).addClass('active');
            $(this).siblings('.tabs.mobile').stop().slideDown(0);
        }

        e.stopPropagation();
    });
    // end tabs   
    
    var theme;
    $('[data-theme]').click(function(){
        theme = $(this).data('theme');
        $('#callbacktheme').val(theme);
    });
	
	var animationDelay = 2500;

    function animateHeadline($headlines) {
    	$headlines.each(function(){
    		var headline = $(this);
    		setTimeout(function(){
    			hideWord(headline.find('.is-visible'))
    		}, animationDelay);
    	});
    }
    
    function hideWord($word) {
    	var nextWord = takeNext($word);
    	switchWord($word, nextWord);
    	setTimeout(function(){ hideWord(nextWord) }, animationDelay);
    }
    
    function takeNext($word) {
    	return (!$word.is(':last-child')) ? $word.next() : $word.parent().children().eq(0);
    }
    
    function switchWord($oldWord, $newWord) {
    	$oldWord.removeClass('is-visible').addClass('is-hidden');
    	$newWord.removeClass('is-hidden').addClass('is-visible');
    }
	
	animateHeadline($('.rotate-text'));

}); // end ready









